---
layout:     ppt
title:      "ã€PPTã€‘çˆ¬è™«é…ç½®è®²è§£"
subtitle:   ""
date:       2021-07-12 09:14:00
author:     "luohq"
header-img: "img/about-bg.jpg"
tags:
    - ppt
---
<textarea data-template>
### ä¸šåŠ¡èƒŒæ™¯
1. æ•°æ®ç»„æƒ³è¦ç¬¬ä¸€æ—¶é—´è·å–å„åœ°é™è¡Œè§„åˆ™
2. æ•°æ®ç»„æ•´ç†äº†å¤§é‡æä¾›é™è¡Œæ–°é—»çš„ç½‘ç«™ã€å¾®ä¿¡å…¬ä¼—å·ã€æ–°æµªå¾®åš
3. æ•°æ®ç»„ä»…éœ€è¦ç½‘ç«™å†…å®¹ä¸­åŒ…å«é™è¡Œæç¤ºçš„å†…å®¹ï¼ˆå³æ–‡ç« è¯¦æƒ…ä¸­åŒ…å«å…³é”®å­—'é™è¡Œ'ç­‰ï¼‰
4. ç½‘ç«™å†…å®¹çš„æå–è¿‡ç¨‹å¤§è‡´éµå¾ªï¼šç½‘ç«™é“¾æ¥ -> æ–‡ç« é“¾æ¥åˆ—è¡¨ -> ç‚¹å‡»é“¾æ¥è·å–æ­£æ–‡è¯¦æƒ…

--

### å¼€å‘èƒŒæ™¯
1. å¼€å‘ä¸€ä¸ªé€šç”¨çš„ç½‘ç«™çˆ¬å–å·¥å…·ï¼Œæœ€å¥½å¯ä»¥é…ç½®çˆ¬å–è§„åˆ™
2. çˆ¬è™«å·¥å…·é€‰æ‹©Python Scrapyï¼šå¯¹äºç½‘ç«™çš„è¶…é“¾æ¥åˆ—è¡¨æå–åŸºäºScrapy.CrawlSpider rulesï¼Œå¯¹æ–‡ç« è¯¦æƒ…å†…å®¹çš„æå–åŸºäºItemLoaders selector
3. çˆ¬è™«è§„åˆ™åŸºäºJSONï¼ˆstart_urls, crawl_rules, item_rulesï¼‰
4. éœ€è¦æä¾›ä¸€ä¸ªçˆ¬è™«è§„åˆ™éªŒè¯å·¥å…·ï¼ˆScrapy+Flaskï¼‰ï¼Œå¯ä»¥éªŒè¯çˆ¬å–è§„åˆ™å¯¹åº”çš„çˆ¬å–ç»“æœæ˜¯å¦æ­£ç¡®

--

<font color='green'><b>ç›¸å…³ä¾èµ–ğŸ€ </b></font><br/>
1. [ğŸ”—Python Scrapyå®˜æ–¹æ–‡æ¡£ï¼šhttps://docs.scrapy.org/en/latest/intro/overview.html](https://docs.scrapy.org/en/latest/intro/overview.html)
2. [ğŸ”—çˆ¬è™«å·¥å…· - æ·»åŠ æ•°æ®æ¥æºï¼šhttp://mx-datacollection-tool.inner.mxnavi.com/mainPage/DataSourceManagement](http://mx-datacollection-tool.inner.mxnavi.com/mainPage/DataSourceManagement)
3. [ğŸ”—çˆ¬è™«é…ç½®éªŒè¯å·¥å…·ï¼šhttp://mx-crawl-spider-validator.inner.mxnavi.com/start](http://mx-crawl-spider-validator.inner.mxnavi.com/start)


---

### çˆ¬è™«é…ç½®è¯´æ˜
1. ç»™å‡ºwebç½‘ç«™åˆå§‹ç•Œé¢é“¾æ¥URL
2. æ ¹æ®cssï¼ˆæˆ–xpathï¼‰è§„åˆ™æå–å‡ºåˆå§‹ç•Œé¢ä¸­çš„è¶…é“¾æ¥ï¼ˆaæ ‡ç­¾ï¼‰åˆ—è¡¨
3. ä¾æ¬¡æ‰“å¼€æå–å‡ºçš„è¶…é“¾æ¥ï¼Œå¹¶ç¡®å®šè¯¦æƒ…ç•Œé¢ä¸­çš„æ ‡é¢˜ã€å‘å¸ƒæ—¥æœŸã€æ­£æ–‡å†…å®¹
4. å°†ä»¥ä¸Š3æ¡ç»„è£…æˆ[ğŸ”—çˆ¬è™«é…ç½®JSONè§„åˆ™](https://marqueeluo.github.io/2021/07/12/ppt-crawler/#/2)
5. é€šè¿‡[ğŸ”—çˆ¬è™«è§„åˆ™éªŒè¯å·¥å…·](https://marqueeluo.github.io/2021/07/12/ppt-crawler/#/3)éªŒè¯çˆ¬å–è§„åˆ™æ˜¯å¦æ­£ç¡®
4. åœ¨çˆ¬è™«å·¥å…·ä¸­å°†çˆ¬è™«é…ç½®JSONè§„åˆ™[ğŸ”—æ·»åŠ åˆ°çˆ¬è™«æ•°æ®æ¥æº](https://marqueeluo.github.io/2021/07/12/ppt-crawler/#/3)

--

### çˆ¬è™«åç«¯é€»è¾‘
1. åç«¯çˆ¬è™«ä¼šå®šæ—¶æ‹‰å–é…ç½®
2. çˆ¬è™«æå–é…ç½®è§„åˆ™ä¸­ç½‘ç«™å¯¹åº”çš„è¯¦æƒ…é¡µä¸­çš„æ ‡é¢˜ã€å‘å¸ƒæ—¥æœŸã€æ­£æ–‡å†…å®¹
3. çˆ¬è™«å¯¹æ ‡é¢˜ã€æ­£æ–‡å†…å®¹ä¸­çš„æ˜¯å¦åŒ…å«å…³é”®å­—è¿›è¡Œè¿‡æ»¤
4. çˆ¬è™«ä»…å°†åŒ…å«å…³é”®å­—çš„ç½‘ç«™è¯¦æƒ…é¡µä¿å­˜åˆ°DB

--

### åç«¯çˆ¬è™«å®šæ—¶ä»»åŠ¡
![img](https://img-blog.csdnimg.cn/20210712140429799.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1bzE1MjQyMjA4MzEw,size_16,color_FFFFFF,t_70)

---

### çˆ¬è™«ç¤ºä¾‹é…ç½®
```json
# è§„åˆ™ã€æœ¬åœ°å®-åŒ—äº¬ã€‘ç¤ºä¾‹å¦‚ä¸‹
{
    # åˆå§‹çˆ¬å–URLï¼ˆæ”¯æŒå¤šä¸ªï¼‰
    "start_urls": [
        "http://bj.bendibao.com/news/list_17_175_1.htm"],

    # ç•Œé¢ä¸­linkæå–è§„åˆ™ï¼ˆæ”¯æŒrestrict_css, restrict_xpath, restrict_jsonï¼‰ï¼Œä¸”æ”¯æŒå¤šæ¡è§„åˆ™ï¼Œ
    # å…¶ä¸­restrict_css, restrict_xpathæ”¯æŒhtmlé¡µé¢è§£æï¼Œè€Œrestrict_jsonæ”¯æŒajaxè¯·æ±‚ï¼ˆrestrict_jsonä¸ºè‡ªå®šä¹‰æå–å™¨ï¼Œå®˜æ–¹æ–‡æ¡£æ²¡æœ‰ç›¸å…³è¯´æ˜ï¼‰
    # å…³äºcrawl_ruleså±æ€§å¯ä»¥å‚è€ƒï¼šhttps://docs.scrapy.org/en/latest/topics/link-extractors.html#topics-link-extractors
    "crawl_rules": [{
            "restrict_css": "#listNewsTimeLy > li > div.info > h3 > a",
            # ç›®å‰callbackä»…æ”¯æŒparse_htmlï¼ˆå³æ ¹æ®item_rulesæå–é¡µé¢ä¸­æ•°æ®ï¼‰
            "callback": "parse_html"
        }
    ],

    # htmlé¡µé¢ä¸­çš„æ•°æ®ä¿¡æ¯æå–è§„åˆ™ï¼ˆæ”¯æŒ{propName}_css|xpathï¼‰
    # ç›®å‰æ”¯æŒå±æ€§ï¼štitle, text, pulish_date
    "item_rules": {
        # {propName}_{type}: [selector1, selector2,...]ä¸”å–ç¬¬ä¸€ä¸ªselectoræœ‰å€¼çš„ç»“æœï¼ˆå¤šä¸ªselectorå…¼å®¹ä¸åŒç½‘é¡µå¸ƒå±€ï¼‰
        "title_css": ["body > div.wrapper > div.content_l > div.title.daoyu > h1 > strong"],
        "text_css": ["#bo"],
        "publish_date_css": ["body > div.wrapper > div.content_l > div.title.daoyu > div.article-info > span.time"]
    }
}
```

--

### çˆ¬è™«è§„åˆ™é…ç½®å»ºè®®
1. å°½é‡ä»¥CSSé€‰æ‹©å™¨é…ç½®
2. å°½é‡å‡å°‘é€‰æ‹©å™¨å±‚çº§ï¼ˆå¯ç»“åˆidã€classç­‰è¿›è¡Œå®šä½ï¼‰

--

ä»¥ä¸‹ç¤ºä¾‹ç½‘ç«™ - è“¬æºªå¿äººæ°‘æ”¿åºœ - å¦‚ä¸‹é…ç½®ä¸å»ºè®®ï¼š<br/>
```json
{
    "start_urls": ["http://www.pengxi.gov.cn/notice"],
    "crawl_rules": [
        {
            "restrict_xpath": "/html/body/div[2]/div[3]/div[1]/div/div[2]/div/div[2]/div/div/div/ul/li/a",
            "callback": "parse_html"
        }
    ],
    "item_rules": {
        "title_xpath": ["/html/body/div[2]/div[3]/div[1]/div/div/div/div/div[2]/table/tbody/tr/td/table/tbody/tr[2]/td/b"],
        "text_xpath": ["/html/body/div[2]/div[3]/div[1]/div/div/div/div/div[2]/table/tbody/tr/td/table/tbody/tr[4]/td/div"],
        "publish_date_xpath": ["/html/body/div[2]/div[3]/div[1]/div/div/div/div/div[2]/table/tbody/tr/td/table/tbody/tr[3]/td/table/tbody/tr/td/div/span[6]"]
    }
}
```
1. å®é™…è·å–ä¸åˆ°é“¾æ¥
2. å±‚çº§å¤ªå¤šå¯è¯»æ€§ä¸å¥½ï¼Œå‡ºé—®é¢˜ä¹Ÿä¸å¥½æ’æŸ¥

--

å»ºè®®ä½¿ç”¨CSSé€‰æ‹©å™¨ä¿®æ”¹å¦‚ä¸‹ï¼š<br/>
```json
{
    "start_urls": ["http://www.pengxi.gov.cn/notice"],
    "crawl_rules": [
        {
            "restrict_css": "div.portlet-column-last a",
            "callback": "parse_html"
        }
    ],
    "item_rules": {
        "title_css": ["td.content-title"],
        "text_css": ["div.content-body"],
        "publish_date_css": ["div.content-baseInfo"]
    }
}

```

--

è‹¥ä½¿ç”¨xpathï¼Œå»ºè®®ä¿®æ”¹å¦‚ä¸‹ï¼š<br/>
```json
{
    "start_urls": ["http://www.pengxi.gov.cn/notice"],
    "crawl_rules": [
        {
            "restrict_xpath": '//div[contains(@class, "classportlet-column-last")]//a',
            "callback": "parse_html"
        }
    ],
    "item_rules": {
        "title_xpath": ['//td[@class="content-title"]'],
        "text_xpath": ['//div[@class="content-body"]'],
        "publish_date_xpath": ['//div[@class="content-baseInfo"]']
    }
}

```

--

### çˆ¬å–è§„åˆ™åˆ†ä¸º2ç§æ–¹å¼
1. åŸºäºhtmlæ–‡æ¡£çˆ¬å–ï¼ˆæŸ¥çœ‹webæµè§ˆå™¨ä¸­æ§åˆ¶å°ä¸­ç¬¬ä¸€ä¸ªè¯·æ±‚ï¼Œå¦‚æœç¬¬ä¸€ä¸ªè¯·æ±‚responseä¸­å«æœ‰é“¾æ¥ï¼Œå³ä¸ºæ–¹å¼1ï¼‰
2. åŸºäºAjax.jsonçˆ¬å–ï¼ˆå¦åˆ™å³ä¸ºæ–¹å¼2ï¼Œéœ€è¦æŸ¥çœ‹æ§åˆ¶å°ä¸­xhrè¯·æ±‚è¯†åˆ«jsonè¯·æ±‚ï¼‰

--

æ–¹å¼2 - ç™¾å®¶å· - æ²­é˜³å’¨è¯¢<br/>
```json
{
    "start_urls": [
        "https://mbd.baidu.com/webpage?tab=main&num=10&uk=ZaalYuiJExafY8flVtp0CQ&source=pc&type=newhome&action=dynamic&format=json&otherext=h5_20201217112057&Tenger-Mhor=601671344"
    ],
    "request_headers": {},
    "request_cookies": {
        "BAIDUID": "EFA0180B2AD916F6F2C907000311BF6E:FG=1"
    },
    "crawl_rules": [{
            "restrict_json": "data.list[*].itemData.url",
            "callback": "parse_html"
        }
    ],
    "item_rules": {
        "title_css": ["#ssr-content > div.app-module_contentWrapper_2jN0Z > div.app-module_headerWrapper_3tNyU > div > h2"],
        "text_css": ["div.index-module_articleWrap_2Zphx"],
        "publish_date_css": ["#ssr-content > div.app-module_contentWrapper_2jN0Z > div.app-module_headerWrapper_3tNyU > div > div > div.index-module_authorTxt_V6XfG > div"]
    }
}
```

--

åœ¨Scrapyä¸­æ”¯æŒcssæ‰©å±•å±æ€§å¦‚ä¸‹ï¼š<br/>
- ï¼ˆ1ï¼‰::text  è·å–å…ƒç´ æ–‡æœ¬ä¿¡æ¯
- ï¼ˆ2ï¼‰::attr(name)  è·å–å…ƒç´ å±æ€§å€¼

---

### çˆ¬è™«éªŒè¯å·¥å…·
![img](https://img-blog.csdnimg.cn/20210712105345616.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1bzE1MjQyMjA4MzEw,size_16,color_FFFFFF,t_70)

--

### çˆ¬å–ç»“æœ
![img](https://img-blog.csdnimg.cn/20210712105500382.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1bzE1MjQyMjA4MzEw,size_16,color_FFFFFF,t_70)

---

### æ·»åŠ çˆ¬è™«æ•°æ®æ¥æº
![img](https://img-blog.csdnimg.cn/20210712100013690.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2x1bzE1MjQyMjA4MzEw,size_16,color_FFFFFF,t_70)

--

<font color='red'><b>æ³¨æ„ğŸ’£</b></font><br/>
1. åŒç±»ç½‘ç«™åœ¨å½•å…¥ã€æ¥æºåç§°ã€‘æ—¶ï¼Œéœ€æŒ‡å®šç»Ÿä¸€å‰ç¼€ï¼ˆå¦‚ï¼šç™¾å®¶å·-, æœç‹æ–°é—»-ï¼‰ï¼Œä»¥æ–¹ä¾¿åç»­ç»Ÿè®¡
2. é€‰æ‹©text_cssçš„æ—¶å€™ï¼Œä¸è¦æŠŠè¾¹æ çš„æ¨èåˆ—è¡¨ä¹Ÿç»™é€‰ä¸Šï¼Œè¦é€‰æ‹©æ­£æ–‡å†…å®¹ï¼Œå¦åˆ™ä¼šå¼•å…¥æ— æ•ˆçš„å…³é”®å­—

---

# OVERâœŒï¸

</textarea>
